<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>B√†i t·∫≠p ƒë·∫øm 1‚Äì5 ‚Äî Quiz cho l·ªõp 1</title>
<style>
  :root{
    --bg1: #fff7fb; --card:#fff; --accent:#ff66b2; --accent2:#ff99cc; --text:#4a2240;
    --good:#2ec27e; --bad:#ff5c7a;
  }
  *{box-sizing:border-box}
  body{font-family: "Baloo 2", "Comic Sans MS", Arial, sans-serif; margin:0; background: linear-gradient(180deg,#fff3f8,#f3fcff); color:var(--text); display:flex; align-items:flex-start; justify-content:center; padding:28px;}
  .wrap{width:min(980px,96vw);}
  header{display:flex;gap:12px;align-items:center;margin-bottom:14px}
  h1{margin:0;font-size:20px;color:var(--accent)}
  .card{background:var(--card); padding:14px;border-radius:14px;box-shadow:0 12px 30px rgba(0,0,0,.06); margin-bottom:12px;border:3px dashed var(--accent2)}
  .center{display:flex;align-items:center;justify-content:center}
  .start-row{gap:10px;display:flex;flex-wrap:wrap;align-items:center;justify-content:center}
  input[type="text"]{padding:10px 12px;border-radius:10px;border:2px solid #ffdce9;min-width:220px;font-size:16px}
  button{background:var(--accent);color:#fff;border:0;padding:10px 16px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:0 6px #ff4d97}
  button:hover{transform:translateY(-2px)}
  .quiz-area{display:none}
  .question-visual{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:10px}
  .shape{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:26px;box-shadow:0 8px 18px rgba(0,0,0,.06)}
  .bear{background:linear-gradient(180deg,#fff,#ffdfe9);border:2px solid #ffc6de;color:#7a2b4a}
  .flower{background:linear-gradient(180deg,#fff,#e6f7ff);border:2px solid #cfefff;color:#155d7a}
  .car{background:linear-gradient(180deg,#fff,#fff6e6);border:2px solid #ffedc2;color:#6a4b1e}
  .candy{background:linear-gradient(180deg,#fff,#fef6ff);border:2px solid #f0d9ff;color:#7b3fa5}
  .balloon{background:linear-gradient(180deg,#fff,#ffeaea);border:2px solid #ffd1d6;color:#9b2b3b}
  .star{background:linear-gradient(180deg,#fff,#fff6e6);border:2px solid #ffe6b3;color:#a36a00}
  .fruit{background:linear-gradient(180deg,#fff,#eafff0);border:2px solid #c9ffd9;color:#1a6a3a}
  .controls{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:10px}
  input[type="number"]{width:86px;padding:10px;border-radius:10px;border:2px solid #ffdce9;text-align:center;font-size:18px}
  .feedback{height:28px;margin-top:8px;font-weight:800;text-align:center}
  .correct{color:var(--good)} .wrong{color:var(--bad)}
  .footer-grid{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
  .history{flex:1;min-width:260px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #f0e6ef;text-align:left;font-size:14px}
  .results{min-width:260px}
  .result-big{font-size:18px;font-weight:900;text-align:center;padding:8px}
  .small{font-size:13px;color:#7a5d6d}
  .play-again{background:#ffb3d9;color:#fff;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:800}
  @media (max-width:600px){ .shape{width:46px;height:46px;font-size:20px} input[type="text"]{min-width:160px} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üéÄ B√†i t·∫≠p ƒë·∫øm 1 ‚Üí 5 (Quiz cho l·ªõp 1)</h1>
  </header>

  <section class="card" id="startCard">
    <div class="center start-row">
      <label class="small">T√™n b√©:</label>
      <input id="playerName" type="text" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." />
      <label class="small">S·ªë c√¢u (m·∫∑c ƒë·ªãnh 10):</label>
      <input id="numQ" type="number" min="5" max="20" value="10" style="width:86px;padding:8px;border-radius:10px;border:2px solid #ffdce9;text-align:center" />
      <button id="startBtn">B·∫Øt ƒë·∫ßu</button>
    </div>
    <p class="small center" style="margin-top:10px">M·ªói c√¢u c√≥ 1 nh√≥m h√¨nh (1‚Äì5). H√£y nh·∫≠p s·ªë t∆∞∆°ng ·ª©ng v√†o √¥ v√† nh·∫•n Tr·∫£ l·ªùi.</p>
  </section>

  <section class="card quiz-area" id="quizCard" aria-live="polite">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
      <div class="small">Ng∆∞·ªùi ch∆°i: <strong id="showName"></strong></div>
      <div class="small">C√¢u <span id="qIndex">1</span>/<span id="qTotal">10</span></div>
      <div class="small">ƒêi·ªÉm: <strong id="score">0</strong></div>
    </div>

    <div id="visual" class="question-visual" role="img" aria-label="Nh√≥m h√¨nh cho c√¢u h·ªèi"></div>

    <div class="controls center">
      <input id="answerInput" type="number" min="1" max="5" placeholder="S·ªë (1-5)" />
      <button id="submitAns">Tr·∫£ l·ªùi</button>
    </div>
    <div id="feedback" class="feedback"></div>
  </section>

  <section class="card" id="endCard" style="display:none">
    <div class="result-big" id="finalText"></div>
    <div class="center" style="gap:8px;margin-top:8px">
      <button class="play-again" id="playAgain">Ch∆°i l·∫°i</button>
      <button class="play-again" id="downloadResults">T·∫£i k·∫øt qu·∫£ (.csv)</button>
    </div>
    <p class="small center" style="margin-top:8px">L·ªãch s·ª≠ s·∫Ω ƒë∆∞·ª£c l∆∞u tr√™n tr√¨nh duy·ªát (localStorage).</p>
  </section>

  <section class="card footer-grid">
    <div class="history card" style="padding:10px">
      <h3 style="margin-top:0">üìö L·ªãch s·ª≠ ch∆°i</h3>
      <table id="historyTable"><thead><tr><th>T√™n</th><th>ƒêi·ªÉm</th><th>Th·ªùi gian</th></tr></thead><tbody></tbody></table>
    </div>
    <div class="results card" style="padding:10px">
      <h3 style="margin-top:0">üîé Th√¥ng tin l·∫ßn ch∆°i hi·ªán t·∫°i</h3>
      <p class="small">B·∫°n c√≥ th·ªÉ xem ƒëi·ªÉm, s·ªë c√¢u, v√† t·∫£i l·ªãch s·ª≠.</p>
      <div style="margin-top:8px">
        <div class="small">T√™n hi·ªán t·∫°i: <strong id="currName">‚Äî</strong></div>
        <div class="small">S·ªë c√¢u: <strong id="currCount">‚Äî</strong></div>
        <div style="margin-top:6px"><button id="clearHistory" class="play-again" style="background:#fff;border:2px solid #ffdce9;color:var(--accent)">X√≥a l·ªãch s·ª≠</button></div>
      </div>
    </div>
  </section>
</div>

<script>
// ===== assets: emoji sets (vector-like) =====
const ICON_SETS = [
  {cls:'bear', emoji:'üêª'}, {cls:'flower', emoji:'üå∏'}, {cls:'car', emoji:'üöó'},
  {cls:'candy', emoji:'üç¨'}, {cls:'balloon', emoji:'üéà'}, {cls:'star', emoji:'‚≠ê'},
  {cls:'fruit', emoji:'üçé'}
];

// ===== state =====
let questions = [];
let curIndex = 0;
let score = 0;
let player = '';
let totalQ = 10;

// helpers
function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function pickIcon(){ return ICON_SETS[rand(0, ICON_SETS.length-1)]; }

function buildQuestions(n){
  const qs = [];
  for(let i=0;i<n;i++){
    const count = rand(1,5);
    const icon = pickIcon();
    qs.push({count, icon});
  }
  return qs;
}

function renderVisual(q){
  const wrap = document.getElementById('visual');
  wrap.innerHTML='';
  for(let i=0;i<q.count;i++){
    const s = document.createElement('div');
    s.className = 'shape '+q.icon.cls;
    s.textContent = q.icon.emoji;
    wrap.appendChild(s);
  }
}

function startGame(){
  const nameInput = document.getElementById('playerName').value.trim();
  if(!nameInput){ alert('Nh·∫≠p t√™n b√© ƒë√£ nha~'); return; }
  player = nameInput;
  totalQ = parseInt(document.getElementById('numQ').value) || 10;
  if(totalQ < 5) totalQ = 5;
  if(totalQ > 20) totalQ = 20;
  questions = buildQuestions(totalQ);
  curIndex = 0; score = 0;
  document.getElementById('startCard').style.display='none';
  document.getElementById('quizCard').style.display='block';
  document.getElementById('endCard').style.display='none';
  document.getElementById('showName').textContent = player;
  document.getElementById('qTotal').textContent = totalQ;
  document.getElementById('qIndex').textContent = 1;
  document.getElementById('score').textContent = score;
  document.getElementById('currName').textContent = player;
  document.getElementById('currCount').textContent = totalQ;
  renderQuestion();
}

function renderQuestion(){
  const q = questions[curIndex];
  renderVisual(q);
  document.getElementById('answerInput').value='';
  document.getElementById('feedback').textContent='';
  document.getElementById('qIndex').textContent = curIndex+1;
  document.getElementById('score').textContent = score;
  document.getElementById('answerInput').focus();
}

function endGame(){
  // show end card & save history
  document.getElementById('quizCard').style.display='none';
  document.getElementById('endCard').style.display='block';
  const finalText = `üéâ ${player} ƒë∆∞·ª£c ${score}/${totalQ} ƒëi·ªÉm!`;
  document.getElementById('finalText').textContent = finalText;
  saveResult({name:player, score, total:totalQ, time: new Date().toLocaleString()});
  loadHistory();
}

// Answer checking
function checkAnswer(){
  const v = document.getElementById('answerInput').value.trim();
  if(!v){ alert('Nh·∫≠p 1 con s·ªë (1‚Äì5) r·ªìi nh·∫•n Tr·∫£ l·ªùi nha'); return; }
  const num = parseInt(v,10);
  if(isNaN(num) || num < 1 || num > 5){ alert('Ch·ªâ ƒë∆∞·ª£c nh·∫≠p s·ªë t·ª´ 1 ƒë·∫øn 5'); return; }
  const q = questions[curIndex];
  const fb = document.getElementById('feedback');
  if(num === q.count){
    score++;
    fb.textContent = '‚úÖ ƒê√∫ng r·ªìi!';
    fb.className = 'feedback correct';
  } else {
    fb.textContent = `‚ùå Sai ‚Äî ƒê√°p √°n ƒë√∫ng l√† ${q.count}`;
    fb.className = 'feedback wrong';
  }
  // small delay then next question
  setTimeout(()=>{
    curIndex++;
    if(curIndex >= totalQ) endGame();
    else renderQuestion();
  }, 900);
}

// ===== localStorage history =====
const STORAGE_KEY = 'baitaptu1den5_history_v1';

function loadHistory(){
  const raw = localStorage.getItem(STORAGE_KEY);
  let arr = raw ? JSON.parse(raw) : [];
  const tbody = document.querySelector('#historyTable tbody');
  tbody.innerHTML = '';
  arr.slice().reverse().forEach(item => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(item.name)}</td><td>${item.score}/${item.total}</td><td>${item.time}</td>`;
    tbody.appendChild(tr);
  });
  return arr;
}

function saveResult(r){
  const raw = localStorage.getItem(STORAGE_KEY);
  let arr = raw ? JSON.parse(raw) : [];
  arr.push(r);
  // keep latest 50
  if(arr.length > 50) arr = arr.slice(arr.length-50);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

// utilities
function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

// download CSV of history
function downloadCSV(){
  const arr = loadHistory();
  if(!arr.length){ alert('Ch∆∞a c√≥ l·ªãch s·ª≠ ƒë·ªÉ t·∫£i.'); return; }
  const rows = [['name','score','total','time']].concat(arr.map(r=>[r.name,r.score,r.total,r.time]));
  const csv = rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'history_baitaptu1den5.csv'; document.body.appendChild(a); a.click();
  URL.revokeObjectURL(url); a.remove();
}

// init bindings
document.getElementById('startBtn').addEventListener('click', startGame);
document.getElementById('submitAns').addEventListener('click', checkAnswer);
document.getElementById('answerInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter') checkAnswer(); });
document.getElementById('playAgain').addEventListener('click', ()=>{ document.getElementById('startCard').style.display='block'; document.getElementById('endCard').style.display='none'; });
document.getElementById('downloadResults').addEventListener('click', downloadCSV);
document.getElementById('clearHistory').addEventListener('click', ()=>{ if(confirm('X√≥a to√†n b·ªô l·ªãch s·ª≠?')){ localStorage.removeItem(STORAGE_KEY); loadHistory(); } });

// load history on open
loadHistory();
</script>
</body>
</html>